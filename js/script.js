const alturaTela=window.innerHeight,botao=document.querySelector(".up-arrow-button");botao.style.display="none",window.onscroll=(()=>{const a=window.pageYOffset;botao.style.display=2*a<alturaTela?"none":"flex"}),botao.addEventListener("click",()=>{window.scroll({top:0,left:0,behavior:"smooth"})});var firebaseConfig={apiKey:"AIzaSyBzcM96Sa57ew3zJVkeFl9XXKtpNjZNt30",authDomain:"web-letters.firebaseapp.com",databaseURL:"https://web-letters.firebaseio.com",projectId:"web-letters",storageBucket:"web-letters.appspot.com",messagingSenderId:"94312142177",appId:"1:94312142177:web:970ccba44d1af4555ee120",measurementId:"G-E2R30KSYNN"};firebase.initializeApp(firebaseConfig),firebase.analytics();const database=firebase.database();class Carta{constructor(a,t,e=""){this.remetente=a,this.mensagem=t,this.key=e}}class CartaController{salvar({remetente:a,mensagem:t}){database.ref("cartas").push().set({remetente:a,mensagem:t})}async buscar(a){const t=await database.ref(`cartas/${a}`).once("value"),{remetente:e,mensagem:r}=t.val();return new Carta(e,r,t.key)}async listar(a){const t=[];return(await database.ref("cartas").limitToLast(a).once("value")).forEach(a=>{const{remetente:e,mensagem:r}=a.val();t.push(new Carta(e,r,a.key))}),t}async paginar(a,t){const e=[],r=await database.ref("cartas").once("value");r.forEach(a=>{const{remetente:t,mensagem:r}=a.val();e.push(new Carta(t,r,a.key))}),e.reverse();const s=1===a?a-1:t*(a-1),i=s+t,n=r.numChildren()/t;return{cartas:e.slice(s,i),totalPaginas:n}}}const CARTA_STORAGE="key_carta";class Index{constructor(){this.cartaController=new CartaController,this.listaCartas=document.querySelector(".lista-cartas"),this.formEnviaCarta=document.querySelector("#form-envia-carta"),this.init()}init(){this.formEnviaCarta.addEventListener("submit",a=>this.handleSubmit(a)),this.exibeUltimasCartas()}handleSubmit(a){a.preventDefault();const t=document.querySelector("#form-envia-carta input[name=remetente]"),e=document.querySelector("#form-envia-carta textarea[name=mensagem]"),r=new Carta(t.value,e.value);this.cartaController.salvar(r),t.value="",e.value="",this.exibeUltimasCartas()}exibeUltimasCartas(){this.listaCartas.innerHTML="",this.cartaController.listar(6).then(a=>{a.reverse(),a.forEach(a=>criaCarta(a.remetente,a.key,this.listaCartas))})}}class CartaPage{constructor(){this.cartaController=new CartaController,this.carta=document.querySelector(".carta"),this.key=sessionStorage.getItem(CARTA_STORAGE),this.init()}async init(){const a=await this.cartaController.buscar(this.key);this.exibeCarta(a)}exibeCarta(a){const t=new RegExp("\n","g");let e=a.mensagem;e=e.replace(t,"<br>"),this.carta.innerHTML=e}}class CartasPage{constructor(){this.cartaController=new CartaController,this.listaCartas=document.querySelector(".lista-cartas"),this.botaoProximaPagina=document.querySelector("#botaoProximaPagina"),this.pagina=1,this.totalPaginas=1,this.quantidadePorPagina=9,this.init()}async init(){this.setButtons(),this.paginarCartas(this.pagina,this.quantidadePorPagina)}async paginarCartas(a=this.pagina,t=this.quantidadePorPagina){const{cartas:e,totalPaginas:r}=await this.cartaController.paginar(a,t);e.forEach(a=>criaCarta(a.remetente,a.key,this.listaCartas)),this.totalPaginas=r,this.botaoProximaPagina.style.display=a>=r?"none":"block"}setButtons(){this.botaoProximaPagina.addEventListener("click",()=>{this.pagina=this.pagina+1,this.paginarCartas(this.pagina,this.quantidadePorPagina)})}}const path=window.location.pathname;function criaCarta(a,t,e){const r={li:document.createElement("li"),p:document.createElement("p"),a:document.createElement("a"),img:document.createElement("img")};r.li.className="item-carta",r.p.className="remetente",r.img.src="img/carta.svg",r.img.alt="Carta de "+a,r.li.appendChild(r.p),r.li.appendChild(r.a),r.a.appendChild(r.img),r.li.dataset.key=t,r.li.onclick=(()=>salvaKeyCarta(t)),r.a.href="carta.html",r.p.innerHTML=`De: ${a}`,e.appendChild(r.li)}function salvaKeyCarta(a){sessionStorage.setItem(CARTA_STORAGE,a)}"/index.html"===path&&new Index,"/carta.html"===path&&new CartaPage,"/cartas.html"===path&&new CartasPage;window.SimpleAnime=class{constructor(){this.items=document.querySelectorAll("[data-anime]"),this.init()}animateItems(){this.items.forEach(i=>{const t=Number(i.getAttribute("data-anime"));isNaN(t)||setTimeout(()=>{i.classList.add("anime")},t)})}handleVisibility(){void 0!==document.visibilityState?"visible"===document.visibilityState&&this.animateItems():this.animateItems()}init(){this.handleVisibility=this.handleVisibility.bind(this),this.handleVisibility(),document.addEventListener("visibilitychange",this.handleVisibility)}},window.SimpleAnime&&new SimpleAnime;